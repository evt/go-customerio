<p align="center">
  <img width="50%" src="https://customer.io/wp-content/uploads/2019/01/customer-io-logo-color.svg">
</p>

<p style="text-align: center;">
  <a target="_blank" rel="noopener noreferrer" href="https://camo.githubusercontent.com/d344ef9d20713185fd51178803a9bb6ae3a18a61d4d2a98c4fcdfe20b15eebc1/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f776f726b666c6f772f7374617475732f6576742f676f2d637573746f6d6572696f2f476f"><img src="https://camo.githubusercontent.com/d344ef9d20713185fd51178803a9bb6ae3a18a61d4d2a98c4fcdfe20b15eebc1/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f776f726b666c6f772f7374617475732f6576742f676f2d637573746f6d6572696f2f476f" alt="Github CI/CD" data-canonical-src="https://img.shields.io/github/workflow/status/evt/go-customerio/Go" style="max-width:100%;"></a>
  <a target="_blank" rel="noopener noreferrer" href="https://camo.githubusercontent.com/4ecf7e2b687427192e545f4fe2e1b9f52c6e1067aaf2b97eea64afe62a67ee00/68747470733a2f2f676f7265706f7274636172642e636f6d2f62616467652f6769746875622e636f6d2f6576742f676f2d637573746f6d6572696f"><img src="https://camo.githubusercontent.com/4ecf7e2b687427192e545f4fe2e1b9f52c6e1067aaf2b97eea64afe62a67ee00/68747470733a2f2f676f7265706f7274636172642e636f6d2f62616467652f6769746875622e636f6d2f6576742f676f2d637573746f6d6572696f" alt="Go Report" data-canonical-src="https://goreportcard.com/badge/github.com/evt/go-customerio" style="max-width:100%;"></a>
  <a target="_blank" rel="noopener noreferrer" href="https://camo.githubusercontent.com/5551450928155b3946a7630bf0f86e7adcdc3af8032bbee4ee978baa9259aea5/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f6c616e6775616765732f746f702f6576742f676f2d637573746f6d6572696f"><img src="https://camo.githubusercontent.com/5551450928155b3946a7630bf0f86e7adcdc3af8032bbee4ee978baa9259aea5/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f6c616e6775616765732f746f702f6576742f676f2d637573746f6d6572696f" alt="Repository Top Language" data-canonical-src="https://img.shields.io/github/languages/top/evt/go-customerio" style="max-width:100%;"></a>
  <a target="_blank" rel="noopener noreferrer" href="https://camo.githubusercontent.com/6dcae8e5da09d439c714f48841e005e1ae7c001a518f8100eb22e1faf08024f5/68747470733a2f2f696d672e736869656c64732e696f2f7363727574696e697a65722f7175616c6974792f672f6576742f676f2d637573746f6d6572696f2f6d6173746572"><img src="https://camo.githubusercontent.com/6dcae8e5da09d439c714f48841e005e1ae7c001a518f8100eb22e1faf08024f5/68747470733a2f2f696d672e736869656c64732e696f2f7363727574696e697a65722f7175616c6974792f672f6576742f676f2d637573746f6d6572696f2f6d6173746572" alt="Scrutinizer Code Quality" data-canonical-src="https://img.shields.io/scrutinizer/quality/g/evt/go-customerio/master" style="max-width:100%;"></a>
  <a target="_blank" rel="noopener noreferrer" href="https://camo.githubusercontent.com/364f96aee377737b932dca5e54adfa158f32a48487b3474cdd2c86147cda77e8/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f676f2d6d6f642f676f2d76657273696f6e2f6576742f676f2d637573746f6d6572696f"><img src="https://camo.githubusercontent.com/364f96aee377737b932dca5e54adfa158f32a48487b3474cdd2c86147cda77e8/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f676f2d6d6f642f676f2d76657273696f6e2f6576742f676f2d637573746f6d6572696f" alt="GitHub go.mod Go version" data-canonical-src="https://img.shields.io/github/go-mod/go-version/evt/go-customerio" style="max-width:100%;"></a>
  <a target="_blank" rel="noopener noreferrer" href="https://camo.githubusercontent.com/bd26bd85a36667767e3ecdcf46e3586166333ec95ca10e966ea35d2f6620f1ac/68747470733a2f2f696d672e736869656c64732e696f2f636f646163792f67726164652f6339343637656434376530363462313938316535333836326430323836643635"><img src="https://camo.githubusercontent.com/bd26bd85a36667767e3ecdcf46e3586166333ec95ca10e966ea35d2f6620f1ac/68747470733a2f2f696d672e736869656c64732e696f2f636f646163792f67726164652f6339343637656434376530363462313938316535333836326430323836643635" alt="Codacy Grade" data-canonical-src="https://img.shields.io/codacy/grade/c9467ed47e064b1981e53862d0286d65" style="max-width:100%;"></a>
  <a target="_blank" rel="noopener noreferrer" href="https://camo.githubusercontent.com/e9098b46008891ff510db4f1cf533cf875dc3db9f7ab180394be05fcef03bf8f/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f7265706f2d73697a652f6576742f676f2d637573746f6d6572696f"><img src="https://camo.githubusercontent.com/e9098b46008891ff510db4f1cf533cf875dc3db9f7ab180394be05fcef03bf8f/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f7265706f2d73697a652f6576742f676f2d637573746f6d6572696f" alt="Github Repository Size" data-canonical-src="https://img.shields.io/github/repo-size/evt/go-customerio" style="max-width:100%;"></a>
  <a target="_blank" rel="noopener noreferrer" href="https://camo.githubusercontent.com/1a2d7ae0f87058d399ea6a4b97e6c280342a3fd1acbcc46ee331d870d7e8ba52/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f6973737565732f6576742f676f2d637573746f6d6572696f"><img src="https://camo.githubusercontent.com/1a2d7ae0f87058d399ea6a4b97e6c280342a3fd1acbcc46ee331d870d7e8ba52/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f6973737565732f6576742f676f2d637573746f6d6572696f" alt="Github Open Issues" data-canonical-src="https://img.shields.io/github/issues/evt/go-customerio" style="max-width:100%;"></a>
  <a target="_blank" rel="noopener noreferrer" href="https://camo.githubusercontent.com/2b4e4d9cf432bf4560de5cd0e8e94633def418328dc39c1071d7b6bb4cce2be5/68747470733a2f2f696d672e736869656c64732e696f2f746f6b65692f6c696e65732f6769746875622f6576742f676f2d637573746f6d6572696f"><img src="https://camo.githubusercontent.com/2b4e4d9cf432bf4560de5cd0e8e94633def418328dc39c1071d7b6bb4cce2be5/68747470733a2f2f696d672e736869656c64732e696f2f746f6b65692f6c696e65732f6769746875622f6576742f676f2d637573746f6d6572696f" alt="Lines of code" data-canonical-src="https://img.shields.io/tokei/lines/github/evt/go-customerio" style="max-width:100%;"></a>
  <a target="_blank" rel="noopener noreferrer" href="https://camo.githubusercontent.com/853fb7afdc04a6c060dd299093a8742ea424a65581673174c4a3263208b93849/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f762f72656c656173652f6576742f676f2d637573746f6d6572696f"><img src="https://camo.githubusercontent.com/853fb7afdc04a6c060dd299093a8742ea424a65581673174c4a3263208b93849/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f762f72656c656173652f6576742f676f2d637573746f6d6572696f" alt="GitHub release (latest by date)" data-canonical-src="https://img.shields.io/github/v/release/evt/go-customerio" style="max-width:100%;"></a>
  <a target="_blank" rel="noopener noreferrer" href="https://camo.githubusercontent.com/0575d4423ece17b3ce60860e59ac2dacceba330dac9e4d6a57b4b319fe10f9bf/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f6c6173742d636f6d6d69742f6576742f676f2d637573746f6d6572696f"><img src="https://camo.githubusercontent.com/0575d4423ece17b3ce60860e59ac2dacceba330dac9e4d6a57b4b319fe10f9bf/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f6c6173742d636f6d6d69742f6576742f676f2d637573746f6d6572696f" alt="GitHub last commit" data-canonical-src="https://img.shields.io/github/last-commit/evt/go-customerio" style="max-width:100%;"></a>
  <a target="_blank" rel="noopener noreferrer" href="https://camo.githubusercontent.com/e6da8ea7697961393fe3e4b3c3fd12aa92f1aad7b3ab491645a358b50d26bc1f/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f636f6e7472696275746f72732f6576742f676f2d637573746f6d6572696f"><img src="https://camo.githubusercontent.com/e6da8ea7697961393fe3e4b3c3fd12aa92f1aad7b3ab491645a358b50d26bc1f/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f636f6e7472696275746f72732f6576742f676f2d637573746f6d6572696f" alt="GitHub contributors" data-canonical-src="https://img.shields.io/github/contributors/evt/go-customerio" style="max-width:100%;"></a>
  <a target="_blank" rel="noopener noreferrer" href="https://camo.githubusercontent.com/ecfdce040eead77ff3397fb3b3684e8eb575eb78cd3fa7621f6e7b75b17e08cb/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f73696d706c792d746865253230626573742532302533422532392d6f72616e6765"><img src="https://camo.githubusercontent.com/ecfdce040eead77ff3397fb3b3684e8eb575eb78cd3fa7621f6e7b75b17e08cb/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f73696d706c792d746865253230626573742532302533422532392d6f72616e6765" alt="Simply the best ;)" data-canonical-src="https://img.shields.io/badge/simply-the%20best%20%3B%29-orange" style="max-width:100%;"></a>
</p>

<img align="right" width="50%" src="https://raw.githubusercontent.com/evt/rest-api-example/main/images/big-gopher.jpg">

# go-customerio [![CircleCI](https://circleci.com/gh/customerio/go-customerio/tree/master.svg?style=svg)](https://circleci.com/gh/customerio/go-customerio/tree/master)

A golang client for the [Customer.io](http://customer.io) [event API](https://app.customer.io/api/docs/index.html).

Godoc here: [https://godoc.org/github.com/customerio/go-customerio](https://godoc.org/github.com/customerio/go-customerio)

## Installation

Add this line to your application's imports:

```go
import (
    // ...
    "github.com/customerio/go-customerio"
)
```

And then execute:

    go get

Or install it yourself:

    $ go get "github.com/customerio/go-customerio"

## Usage

### Before we get started: API client vs. JavaScript snippet

It's helpful to know that everything below can also be accomplished
through the [Customer.io JavaScript snippet](http://customer.io/docs/basic-integration.html).

In many cases, using the JavaScript snippet will be easier to integrate with
your app, but there are several reasons why using the API client is useful:

- You're not planning on triggering emails based on how customers interact with
  your website (e.g. users who haven't visited the site in X days)
- You're using the javascript snippet, but have a few events you'd like to
  send from your backend system. They will work well together!
- You'd rather not have another javascript snippet slowing down your frontend.
  Our snippet is asynchronous (doesn't affect initial page load) and very small, but we understand.

In the end, the decision on whether or not to use the API client or
the JavaScript snippet should be based on what works best for you.
You'll be able to integrate **fully** with [Customer.io](http://customer.io) with either approach.

### Setup

Create an instance of the client with your [customer.io](http://customer.io) credentials
which can be found on the [customer.io integration screen](https://manage.customer.io/integration).

```go
track := customerio.NewTrackClient("YOUR SITE ID", "YOUR API SECRET KEY")
```

### Identify logged in customers

Tracking data of logged in customers is a key part of [Customer.io](http://customer.io). In order to
send triggered emails, we must know the email address of the customer. You can
also specify any number of customer attributes which help tailor [Customer.io](http://customer.io) to your
business.

Attributes you specify are useful in several ways:

- As customer variables in your triggered emails. For instance, if you specify
  the customer's name, you can personalize the triggered email by using it in the
  subject or body.

- As a way to filter who should receive a triggered email. For instance,
  if you pass along the current subscription plan (free / basic / premium) for your customers, you can
  set up triggers which are only sent to customers who have subscribed to a
  particular plan (e.g. "premium").

You'll want to identify your customers when they sign up for your app and any time their
key information changes. This keeps [Customer.io](http://customer.io) up to date with your customer information.

```go
// Arguments
// customerID (required) - a unique identifier string for this customers
// attributes (required) - a ```map[string]interface{}``` of information about the customer. You can pass any
//                         information that would be useful in your triggers. You
//                         should at least pass in an email, and created_at timestamp.
//                         your interface{} should be parseable as Json by 'encoding/json'.Marshal

track.Identify("5", map[string]interface{}{
  "email": "bob@example.com",
  "created_at": time.Now().Unix(),
  "first_name": "Bob",
  "plan": "basic",
})
```

### Deleting customers

Deleting a customer will remove them, and all their information from
Customer.io. Note: if you're still sending data to Customer.io via
other means (such as the javascript snippet), the customer could be
recreated.

```go
// Arguments
// customerID (required) - a unique identifier for the customer.  This
//                          should be the same id you'd pass into the
//                          `identify` command above.

track.Delete("5")
```

### Tracking a custom event

Now that you're identifying your customers with [Customer.io](http://customer.io), you can now send events like
"purchased" or "watchedIntroVideo". These allow you to more specifically target your users
with automated emails, and track conversions when you're sending automated emails to
encourage your customers to perform an action.

```go
// Arguments
// customerID (required)  - the id of the customer who you want to associate with the event.
// name (required)        - the name of the event you want to track.
// attributes (optional)  - any related information you'd like to attach to this
//                          event, as a ```map[string]interface{}```. These attributes can be used in your triggers to control who should
//                         receive the triggered email. You can set any number of data values.

track.Track("5", "purchase", map[string]interface{}{
    "type": "socks",
    "price": "13.99",
})
```

### Tracking an anonymous event

[Anonymous
events](https://learn.customer.io/recipes/anonymous-invite-emails.html) are
also supported. These are ideal for when you need to track an event for a
customer which may not exist in your People list.

```go
// Arguments
// name (required)            - the name of the event you want to track.
// attributes (optional)      - any related information you'd like to attach to this
//                              event, as a ```map[string]interface{}```. These attributes can be used in your triggers to control who should
//                              receive the triggered email. You can set any number of data values.

track.TrackAnonymous("invite", map[string]interface{}{
    "first_name": "Alex",
    "source": "OldApp",
})
```

### Adding a device to a customer

In order to send push notifications, we need customer device information.

```go
// Arguments
// customerID (required) - a unique identifier string for this customer
// deviceID (required)   - a unique identifier string for this device
// platform (required)   - the platform of the device, currently only accepts 'ios' and 'andriod'
// data (optional)        - a ```map[string]interface{}``` of information about the device. You can pass any
//                         key/value pairs that would be useful in your triggers. We
//                         currently only save 'last_used'.
//                         your interface{} should be parseable as Json by 'encoding/json'.Marshal

track.AddDevice("5", "messaging token", "android", map[string]interface{}{
"last_used": time.Now().Unix(),
})
```

### Deleting devices

Deleting a device will remove it from the customers device list in Customer.io.

```go
// Arguments
// customerID (required) - the id of the customer the device you want to delete belongs to
// deviceToken (required) - a unique identifier for the device.  This
//                          should be the same id you'd pass into the
//                          `addDevice` command above

track.DeleteDevice("5", "messaging-token")
```

### Send Transactional Messages

To use the Customer.io [Transactional API](https://customer.io/docs/transactional-api), create an instance of the API client using an [app key](https://customer.io/docs/managing-credentials#app-api-keys).

Create a `SendEmailRequest` instance, and then use `SendEmail` to send your message. [Learn more about transactional messages and optional `SendEmailRequest` properties](https://customer.io/docs/transactional-api).

You can also send attachments with your message. Use `Attach` to encode attachments.

```go
import "github.com/customerio/go-customerio"

client := customerio.NewAPIClient("<extapikey>");

// TransactionalMessageId — the ID of the transactional message you want to send.
// To                     — the email address of your recipients.
// Identifiers            — contains the id of your recipient. If the id does not exist, Customer.io creates it.
// MessageData            — contains properties that you want reference in your message using liquid.
// Attach                 — a helper that encodes attachments to your message.

request := customerio.SendEmailRequest{
  To: "person@example.com",
  TransactionalMessageID: "3",
  MessageData: map[string]interface{}{
    "name": "Person",
    "items": map[string]interface{}{
      "name": "shoes",
      "price": "59.99",
    },
    "products": []interface{}{},
  },
  Identifiers: map[string]string{
    "id": "example1",
  },
}

// (optional) attach a file to your message.
f, err := os.Open("receipt.pdf")
if err != nil {
  fmt.Println(err)
}
request.Attach("receipt.pdf", f)

body, err := client.SendEmail(context.Background(), &request)
if err != nil {
  fmt.Println(err)
}

fmt.Println(body)
```

## Contributing

1. Fork it
2. Clone your fork (`git clone git@github.com:MY_USERNAME/go-customerio.git && cd go-customerio`)
3. Create your feature branch (`git checkout -b my-new-feature`)
4. Commit your changes (`git commit -am 'Added some feature'`)
5. Push to the branch (`git push origin my-new-feature`)
6. Create new Pull Request
